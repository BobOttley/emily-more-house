From 3b0a32b4fe1010b01b122dc465115d15020d6338 Mon Sep 17 00:00:00 2001
From: Claude <noreply@anthropic.com>
Date: Tue, 28 Oct 2025 15:57:18 +0000
Subject: [PATCH] Fix chatbot iframe overflow - prevent top from disappearing
 when expanded
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

When the chatbot expands in the digital prospectus, the top was getting cut off
and disappearing from view. This fix dynamically adjusts the wrapper's bottom
position based on the chatbot height to keep it fully visible.

Changes:
- Modified applySize() function in prospectus_template.html
- Added dynamic bottom positioning calculation
- Handles three states: bubble mode, expanded (fits viewport), and expanded (taller than viewport)
- Ensures minimum margins to prevent cutoff

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
---
 public/prospectus_template.html | 31 +++++++++++++++++++++++++++++++
 1 file changed, 31 insertions(+)

diff --git a/public/prospectus_template.html b/public/prospectus_template.html
index 58fb357..542c890 100644
--- a/public/prospectus_template.html
+++ b/public/prospectus_template.html
@@ -3039,6 +3039,37 @@ ${extracurricularPersonalization ? `<p>${extracurricularPersonalization}</p>` :
     var s = clampToViewport(w, h);
     iframe.style.width  = s.w + 'px';
     iframe.style.height = s.h + 'px';
+    
+    // FIX: Dynamically adjust wrapper bottom position to keep chatbot fully visible
+    var wrapper = document.getElementById(WRAP_ID);
+    if (wrapper) {
+      var viewportHeight = window.innerHeight || 768;
+      var chatbotHeight = s.h;
+      var minBottomMargin = 18;
+      
+      // Calculate if chatbot would extend beyond top of viewport
+      var spaceNeeded = chatbotHeight + (2 * minBottomMargin); // chatbot + top margin + bottom margin
+      
+      if (spaceNeeded > viewportHeight) {
+        // Chatbot is taller than viewport - anchor to top with max-height
+        wrapper.style.bottom = '';
+        wrapper.style.top = minBottomMargin + 'px';
+        wrapper.style.maxHeight = (viewportHeight - (2 * minBottomMargin)) + 'px';
+        wrapper.style.overflow = 'visible';
+        iframe.style.maxHeight = '100%';
+      } else if (chatbotHeight > 200) {
+        // Chatbot is expanded but fits - adjust bottom to keep top visible
+        var bottomPos = Math.max(minBottomMargin, viewportHeight - chatbotHeight - minBottomMargin);
+        wrapper.style.top = '';
+        wrapper.style.bottom = bottomPos + 'px';
+        wrapper.style.maxHeight = '';
+      } else {
+        // Chatbot is in bubble mode - use default bottom positioning
+        wrapper.style.top = '';
+        wrapper.style.bottom = '18px';
+        wrapper.style.maxHeight = '';
+      }
+    }
   }
 
   function ensureWrapper() {
-- 
2.43.0

